{"version":3,"sources":["../src/dynamic_tabs.js"],"names":["SELECTORS","dynamicTabs","activeTab","allActiveTabs","tabContent","tabToggle","tabPane","forTabName","tabName","forTabId","init","on","previousTabName","getActiveTabName","previousTab","document","querySelector","textContent","tab","attr","length","loadTab","openTabFromHash","tabs","openTab","getAttribute","classList","add","indicateNodeIsLoading","node","Templates","render","then","html","js","replaceNodeContents","catch","Notification","exception","element","getFirstTabName","dataset","additionalData","pendingPromise","Pending","tabdata","closest","wsData","reportid","id","tabjs","tabClass","JSON","stringify","data","javascript","template","parse","content","resolve","getTab","getTabPane","getElementById","hash","location","match","replace"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Dynamic Tabs UI element with AJAX loading of tabs content\n *\n * @module      core/dynamic_tabs\n * @copyright   2021 David Matamoros <davidmc@moodle.com> based on code from Marina Glancy\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport {getContent} from 'core/local/repository/dynamic_tabs';\n\nconst SELECTORS = {\n    dynamicTabs: '.dynamictabs',\n    activeTab: '.dynamictabs .nav-link.active',\n    allActiveTabs: '.dynamictabs .nav-link[data-toggle=\"tab\"]:not(.disabled)',\n    tabContent: '.dynamictabs .tab-pane [data-tab-content]',\n    tabToggle: 'a[data-toggle=\"tab\"]',\n    tabPane: '.dynamictabs .tab-pane',\n};\n\nSELECTORS.forTabName = tabName => `.dynamictabs [data-tab-content=\"${tabName}\"]`;\nSELECTORS.forTabId = tabName => `.dynamictabs [data-toggle=\"tab\"][href=\"#${tabName}\"]`;\n\n/**\n * Initialises the tabs view on the page (only one tabs view per page is supported)\n */\nexport const init = () => {\n    // This code listens to Bootstrap events 'show.bs.tab' and 'shown.bs.tab' which is triggered using JQuery and\n    // can not be converted yet to native events.\n    $(SELECTORS.tabToggle).on('show.bs.tab', function() {\n        // Clean content from previous tab.\n        const previousTabName = getActiveTabName();\n        if (previousTabName) {\n            const previousTab = document.querySelector(SELECTORS.forTabName(previousTabName));\n            previousTab.textContent = '';\n        }\n    });\n    $(SELECTORS.tabToggle).on('shown.bs.tab', function() {\n        const tab = $($(this).attr('href'));\n        if (tab.length !== 1) {\n            return;\n        }\n        loadTab(tab.attr('id'));\n    });\n\n    if (!openTabFromHash()) {\n        const tabs = document.querySelector(SELECTORS.allActiveTabs);\n        if (tabs) {\n            openTab(tabs.getAttribute('aria-controls'));\n        } else {\n            // We may hide tabs if there is only one available, just load the contents of the first tab.\n            const tabPane = document.querySelector(SELECTORS.tabPane);\n            if (tabPane) {\n                tabPane.classList.add('active', 'show');\n                loadTab(tabPane.getAttribute('id'));\n            }\n        }\n    }\n};\n\n/**\n * Show \"loading\" template instead of a node\n *\n * @param {HTMLElement} node\n * @return {Promise}\n */\nconst indicateNodeIsLoading = (node) => {\n    return Templates.render('core/loading', {})\n        .then((html, js) => {\n            return Templates.replaceNodeContents(node, html, js);\n        }).catch(Notification.exception);\n};\n\n/**\n * Returns id/name of the currently active tab\n *\n * @return {String|null}\n */\nconst getActiveTabName = () => {\n    const element = document.querySelector(SELECTORS.activeTab);\n    return element?.getAttribute('aria-controls') || null;\n};\n\n/**\n * Returns the id/name of the first tab\n *\n * @return {String|null}\n */\nconst getFirstTabName = () => {\n    const element = document.querySelector(SELECTORS.tabContent);\n    return element?.dataset.tabContent || null;\n};\n\n/**\n * Loads contents of a tab using an AJAX request\n *\n * @param {String} tabName\n * @param {Object} additionalData additional data to pass to WS\n */\nconst loadTab = (tabName, additionalData = {}) => {\n    // If tabName is not specified find the active tab, or if is not defined, the first available tab.\n    tabName = tabName ?? getActiveTabName() ?? getFirstTabName();\n\n    const tab = document.querySelector(SELECTORS.forTabName(tabName));\n    if (!tab) {\n        return;\n    }\n\n    const pendingPromise = new Pending('core/dynamic_tabs:loadTab:' + tabName);\n    const tabdata = tab.closest(SELECTORS.dynamicTabs);\n    const wsData = {\n        'reportid': tabdata.dataset.reportid,\n        'id': tabdata.dataset.id,\n        ...additionalData\n    };\n    let tabjs = '';\n    tab.textContent = '';\n\n    indicateNodeIsLoading(tab)\n    .then(() => {\n        return getContent(tab.dataset.tabClass, JSON.stringify(wsData));\n    })\n    .then((data) => {\n        tabjs = data.javascript;\n        return Templates.render(data.template, JSON.parse(data.content));\n    })\n    .then((html, js) => {\n        return Templates.replaceNodeContents(tab, html, js + tabjs);\n    })\n    .then(() => {\n        pendingPromise.resolve();\n        return null;\n    })\n    .catch(Notification.exception);\n};\n\n/**\n * Return the tab given the tab name\n *\n * @param {String} tabName\n * @return {HTMLElement}\n */\nconst getTab = (tabName) => {\n    return document.querySelector(SELECTORS.forTabId(tabName));\n};\n\n/**\n * Return the tab pane given the tab name\n *\n * @param {String} tabName\n * @return {HTMLElement}\n */\nconst getTabPane = (tabName) => {\n    return document.getElementById(tabName);\n};\n\n/**\n * Open the tab on page load. If this script loads before theme_boost/tab we need to open tab ourselves\n *\n * @param {String} tabName\n * @return {Boolean}\n */\nconst openTab = (tabName) => {\n    const tab = getTab(tabName);\n    if (!tab) {\n        return false;\n    }\n\n    loadTab(tabName);\n    tab.classList.add('active');\n    getTabPane(tabName).classList.add('active', 'show');\n    return true;\n};\n\n/**\n * If there is a location hash that is the same as the tab name - open this tab.\n *\n * @return {Boolean}\n */\nconst openTabFromHash = () => {\n    const hash = document.location.hash;\n    if (hash.match(/^#\\w+$/g)) {\n        return openTab(hash.replace(/^#/g, ''));\n    }\n\n    return false;\n};\n"],"file":"dynamic_tabs.min.js"}